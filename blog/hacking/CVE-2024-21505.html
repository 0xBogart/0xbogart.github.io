<!DOCTYPE html>
<html lang="es">
<head>
	<title>CVE-2024-21505 | ØxBogart</title>

	<!-- meta -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,user-scalable=no,viewport-fit=cover">
	<link rel="icon" type="/image/png" href="/blog/img/skull.png">
	<link rel="canonical" href="https://0xbogarft.github.io/blog/hacking/CVE-2024-21505">
	<meta name="author" content="Bogart">
	<meta name="description" content="CVE-2024-21505">
	<meta name="keywords" content="CVE-2024-21505">

	<!-- Twitter Tags -->
	<meta property="og:title" content="CVE-2024-21505">
	<meta property="og:description" content="CVE-2024-21505">
	<meta property="og:url" content="https://0xbogart.github.io/blog/hacking/CVE-2024-21505">
	<meta property="og:image" content="https://0xbogart.github.io/blog/img/cve-2024-21505.jpg">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@jfb0gart">
	<meta name="twitter:creator" content="@jfb0gart">
	<meta name="twitter:title" content="CVE-2024-21505 | ØxBogart">
	<meta name="twitter:description" content="CVE-2024-21505 | ØxBogart">
	<meta property="twitter:image" content="https://0xbogart.github.io/blog/img/cve-2024-21505.jpg">		

	<!-- css -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/ionicons.min.css">
	<link rel="stylesheet" href="/css/tabbared.css">
	<link rel="stylesheet" href="/css/sidebared.css">
	<link rel="stylesheet" href="/css/pace.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="stylesheet" href="/css/blackarchterm.css">
	<link rel="stylesheet" href="/css/blackarchvoid.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

	<!-- js -->
	<script src="/js/jquery-2.1.3.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/js/pace.min.js"></script>
	<script src="/js/modernizr.custom.js"></script>
	<script src="/js/tabbar.js"></script>
	<script src="/js/asredlight.js"></script>
<style>
@media (max-width: 600px) {
  .imgmax {
    width: 104%; /* Ancho al 100% para pantallas de 600px o menos */
  }
}

.bg {
	border: 5px solid black;
	width: 100%;
}
</style>
</head>

<body class="bg">
	<div class="container">	
		<header id="site-header">
			<div class="row">
				<div style="margin-bottom: -10%;">
					<h1 style="margin-top: 7px;">H<a href="/blog/hacking"><img src="/blog/img/skullh.png" width="30px" height="40px" style="margin-top: -9px;"></a>CKING</h1>
				</div><!-- col-4 -->
			</div>
			<div class="row justify-content-end">
				<div class="col-2" style="margin-top: 5px;">
					<nav class="navbar navbar-expand-lg navbar-light">
						<button style="border: 1px solid #D80000;" class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#bs-example-navbar-collapse-1" aria-controls="bs-example-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
							<span class="navbar-toggler-icon"></span>
						</button>
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="navbar-nav">
								<li class="nav-item">
									<a style="font-size: 25px;" class="nav-link" href="/index" data-hover="Home">Home</a>
								</li>
							</ul>
						</div><!--- .navbar-collapse --->
					</nav>
				</div><!-- col-md-8 -->
			</div>
		</header>
	</div>

	<!-- TABBAR -->
	<div style="position: sticky; top: -1px; width: auto;">
		<a onclick="toggleDropdown()">
			<div class="tabbar">
				<span style="font-weight: bold; float: left; margin-left: 10px;">TABLA DE CONTENIDO</span>
				<div class="dropdown-content" id="dropdownContent"></div>
			</div>
		</a>
		<div id="contenido">
			<h5>Web3-Utils [CVE-2024-21505] Prototype Pollution</h5>
			<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
			<a href="#HistoryTelling" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ HistoryTelling</p></a>
			<a href="#AUDIT" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ ¿Qué es Prototype Pollution?</p></a>
			<a href="#EXPLOIT" style="text-decoration: none;"><p style="margin-bottom: 6px; font-size: 16px;">☠ Explotando la Vulnerabilidad [CVE-2021-43798]</p></a>
		</div>
	</div><!-- END TABBAR -->

	<div class="content-body">
		<div id="main" style="position: sticky; top: 0;">
			<button class="openbtn" onclick="toggleNav()">☠</button>
		</div><br>
		<div id="mySidebar" class="sidebar" style="display: none; position: sticky; top: 0; margin-top: -24px; padding-right: 1px;">
			<a href="javascript:void(0)" class="closebtn" onclick="toggleNav()">×</a>
			<span style="font-size: 25px; color: #ff0000;"><b>&nbsp;✎</b></span><span style="font-size: 25px; color: white;"> <b>Notas</b></span>
			<hr style="color: #ff0000;">
			<a><span style="color: #E5D400;">NPM</span><span class="spanx">: Administrador de paquetes predeterminado para el tiempo de ejecución de JavaScript Node.js</span></a>
			<a><span style="color: #E5D400;">Web3-Utils</span><span class="spanx">: Colección de funciones de utilidad utilizadas en web3.js</span></a>
		</div>
		<div class="container">
			<div class="row">
				<main class="col-md-8" style="margin-left: auto; margin-right: auto;">
					<article class="post post-1">
						<header  class="entry-header">
							<h1 class="blh1">Web3-Utils [Prototype Pollution]</h1>
							<h2 class="blh2"><a style="color: #DB0000;">CVE</a>-<a style="color: #DB0000;">2024</a>-<a style="color: #DB0000;">21505</a></h2>
						</header>
						<div class="entry-content clearfix">
							<br><br>
							<section id="HistoryTelling">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">HISTORYTELLING</span>
								</div><br>
								<div class="centext">
									<span><b>NPM</b> [<b>Node Package Manager</b>] es el administrador de paquetes predeterminado en tiempo de ejecución de JavaScript <b>Node.js</b>.</span>
									<br><br>
									<span>El <b>5 de febrero de 2024</b> se descubrió una vulnerabilidad de Contaminación de Prototipos [<b>Prototype Pollution</b>] en el paquete Web3-Utils de <b>npm</b></span>
									<br><br>
									<span><b>El 24 de marzo de 2024</b>, el equipo de <b>NPM</b> confirmó la vulnerabilidad haciendolo público en su portal oficial.</span>
								</div>
							</section>

							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
								
							<!----- ¿QUÉ ES PROTOTYPE POLLUTION? ---->
							<section style="margin-top: 130px;" id="PROTOTYPEPOLLUTION">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">¿QUÉ ES PROTOTYPE POLLUTION?</span>
								</div><br>
								<div class="leftl">
									<span>La Contaminación de Prototipos hace referencia a la capacidad de inyectar propiedades en los prototipos de construcción existentes en el lenguaje JavaScript, como pueden ser los objetos.</span>
									<br><br>
									<span>JavaScript permite alterar todos los atributos de los objetos, incluidos sus atributos mágicos como serían <b>__proto__</b>, <b>constructor</b> y <b>prototype</b>. Un atacante podría manipular estos atributos para sobrescribir o contaminar un prototipo de objeto de una aplicación JavaScript del objeto base inyectando otros valores, lo cual alteraría el comportamiento original de la aplicacion.</span>
									<br><br>
									<span>Las propiedades del Object.prototype son heredadas por todos los objetos JavaScript a través de la cadena de prototipos. Cuando esto ocurre, se produce una Denegación de Servicio [<b>DoS</b>] al provocar excepciones de JavaScript, o también se manipula el código fuente de la aplicación para forzar la ruta de código que el atacante inyecta, lo que conduce a la ejecución remota de código [<b>RCE</b>].</span>
								</div>
							</section>

							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>

							<section style="margin-top: 130px;" id="AUDITCODE">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">AUDITANDO EL FARGMENTO DE CÓDIGO VULNERABLE</span>
								</div><br>
				
								<div class="leftl">
									<span>En la línea original [resaltada en rojo] no se realiza una clonación profunda del objeto <b>destination</b>. Simplemente asigna la misma referencia del objeto <b>destination</b> a la variable <b>result</b>. Así que result y destination apuntan al mismo objeto y por ende a la misma dirección de memoria, por lo que cualquier modificación realizada en result afectará a destination.</span>
									<br><br>
									<span>Sin embargo en la línea corregida [resaltada en verde], se utiliza el operador de propagación (<a style="color: #d80000;"><b>...</b></a>) para realizar una copia superficial del objeto <b>destination</b>. La copia superficial crea un nuevo objeto y copia las referencias de las propiedades del objeto original al nuevo objeto. Sin embargo, si las propiedades del objeto son a su vez objetos anidados, estas propiedades se copiarán como referencias al mismo objeto en la memoria, en lugar de crear copias independientes. Por lo tanto, no es una copia profunda completa del objeto.</span>
								</div><br><br>

								<!---- AUDIT CODE OBJECTS.TS ---->
								<div class="centext">
									<span class="centext">Fragmento de código de: <b>packages/web3-utils/src/objects.ts</b></span>
								</div><br>
								<div id="long-terminal">   
									<!-- Terminal Body -->
									<section id="terminal_body">
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><a style="color: #ff7b72;">import</a> { TypedArray } <a style="color: #ff7b72;">from</a> <a style="color: #a5d6ff;">'web3-types'</a>;</span>
										</div>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><a style="color: #ff7b72;">import</a> { isNullish } <a style="color: #ff7b72;">from</a> <a style="color: #a5d6ff;">'web3-validator'</a>;</span>
										</div>
										<br>
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><a style="color: #ff7b72;">const</a> <a style="color: #d2a8ff;">isIterable</a> <a style="color: #a5d6ff;">=</a> (item: unknown): item is Record&lt;string, unknown&gt; <a style="color: #a5d6ff;">=&gt;</a></span>
										</div>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 30px; color: #fff;"><a style="color: #ff7b72;">typeof</a> item <a style="color: #79c0ff;">===</a> <a style="color: #a5d6ff;">'object'</a> <a style="color: #79c0ff;">&amp;&amp;</a></span>
										</div>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 30px; color: #fff;"><a style="color: #79c0ff;">!</a><a style="color: #d2a8ff;">isNullish</a>(item) <a style="color: #79c0ff;">&amp;&amp;</a></span>
										</div>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 30px; color: #fff;"><a style="color: #79c0ff;">!</a>Array.<a style="color: #d2a8ff;">isArray</a>(item) <a style="color: #79c0ff;">&amp;&amp;</a></span>
										</div>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling"><a style="color: #fff; margin-left: 30px;"><a style="color: #79c0ff;">!</a>(item <a style="color: #ff7b72;">instanceof</a> TypedArray);</a></span>
										</div>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;"><a style="color: #ff7b72;">export const</a> <a style="color: #d2a8ff;">mergeDeep</a> <a style="color: #79c0ff;">=</a> (</span>
										</div>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 25px; color: #fff;">destination: Record&lt;string, unknown&gt;,</span>
										</div>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 25px; color: #fff;">...sources: Record&lt;string, unknown&gt;[]</span>
										</div>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;">): Record&lt;string, unknown&gt; <a style="color: #79c0ff;">=</a>&gt; {</span>
										</div><br>
										  
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="background: linear-gradient(90deg, rgba(121,9,9,0.5102415966386555) 100%, rgba(2,0,36,1) 100%, rgba(0,212,255,1) 100%); padding-right: 40%;"><b><a style="color: #fff; margin-left: 30px;"><a style="color: #ff7b72;">const</a> result <a style="color: #79c0ff;">=</a> destination; // clone deep here</a></b></span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="background: linear-gradient(90deg, rgba(45,121,9,0.5102415966386555) 100%, rgba(2,0,36,1) 100%, rgba(0,212,255,1) 100%); padding-right: 40%;"><b><a style="color: #fff; margin-left: 30px;"><a style="color: #ff7b72;">const</a> result <a style="color: #79c0ff;">=</a> { ...destination }; // clone deep here</a></b></span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="color: #fff; margin-left: 30px;"><a style="color: #ff7b72;">if</a> (<a style="color: #79c0ff;">!</a><a style="color: #d2a8ff;">isIterable</a>(result)) {</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 50px; color: #fff;"><a style="color: #ff7b72;">return</a> result;</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 30px; color: #fff;">}</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 30px; color: #fff;"><a style="color: #ff7b72;">for</a> (<a style="color: #ff7b72;">const</a> src <a style="color: #ff7b72;">of</a> sources) {</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 50px;">// eslint-disable-next-line no-restricted-syntax</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 50px; color: #fff;"><a style="color: #ff7b72;">for</a> (<a style="color: #ff7b72;">const</a> key <a style="color: #ff7b72;">in</a> src) {</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 75px; color: #fff;"><a style="color: #ff7b72;">if</a> (<a style="color: #d2a8ff;">isIterable</a>(src[key])) {</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 95px; color: #fff;"><a style="color: #ff7b72;">if</a> (<a style="color: #79c0ff;">!</a>result[key]) {</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 115px; color: #fff;">result[key] <a style="color: #79c0ff;">=</a> {};</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 95px; color: #fff;">}</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 95px; color: #fff;"><a style="color: #d2a8ff;">mergeDeep</a>(</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 115px; color: #fff;">result[key] <a style="color: #ff7b72;">as</a> Record&lt;string, unknown&gt;,</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 115px; color: #fff;">src[key] <a style="color: #ff7b72;">as</a> Record&lt;string, unknown&gt;,</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 95px; color: #fff;">);</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 75px; color: #fff;">} <a style="color: #ff7b72;">else if</a> (<a style="color: #79c0ff;">!</a><a style="color: #d2a8ff;">isNullish</a>(src[key]) <a style="color: #79c0ff;">&amp;&amp;</a> Object.<a style="color: #a5d6ff;">hasOwnProperty</a>.<a style="color: #d2a8ff;">call</a>(src, key)) {</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 95px; color: #fff;"><a style="color: #ff7b72;">if</a> (Array.<a style="color: #d2a8ff;">isArray</a>(src[key]) <a style="color: #79c0ff;">||</a> src[key] <a style="color: #ff7b72;">instanceof</a> TypedArray) {</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 115px; color: #fff;">result[key] <a style="color: #79c0ff;">=</a> (src[key] <a style="color: #ff7b72;">as</a> unknown[]).<a style="color: #d2a8ff;">slice</a>(<a style="color: #79c0ff;">0</a>);</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 95px; color: #fff;">} <a style="color: #ff7b72;">else</a> {</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 115px; color: #fff;">result[key] <a style="color: #79c0ff;">=</a> src[key];</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 95px; color: #fff;">}</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 75px; color: #fff;">}</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 55px; color: #fff;">}</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 35px; color: #fff;">}</span>
										</div>

										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 35px; color: #fff;"><a style="color: #ff7b72;">return</a> result;</span>
										</div>
										
										<div id="terminal__prompt">
											<span id="terminal__prompt--bling" style="margin-left: 1px; color: #fff;">};</span>
										</div>
									  </section>
								</div>
								<br><br>
								<div class="leftl">
									<span>La corrección se basa en realizar una copia superficial del objeto destination para evitar que result y destination compartan la misma referencia en la memoria. Aunque no es una copia profunda completa, es suficiente para garantizar que las modificaciones en result no afecten directamente a destination.</span>
								</div>
							</section>
							<!---- AUDIT CODE ---->

							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>

							<!--- EXPLOTANDO CVE-2024-21505 --->
							<section style="margin-top: 130px;" id="EXPLOIT">
								<div class="centext">
									<a style="font-size: 19px; color: rgb(189, 0, 38);">☠ </a><span class="red-bg" style="font-size: 19px;">EXPLOTANDO CVE-2024-21505 [PoC]</span>
								</div><br>

								<div class="leftl">
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000;">⦿</a> Crear el directorio de trabajo y el archivo <b>cve-2024-21505.js</b> para la prueba de concepto [PoC]</b></span><br>
									<img src="/blog/hacking/img/cve-2024-21505.png"><br><br><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000;">⦿</a> Instalar una versión vulnerable del paquete Web3-Utils:</b></span><br>
									<img src="/blog/hacking/img/npm.png"><br><br><br>
									<span style="margin-bottom: 10px;"><b><a style="color: #DB0000;">⦿</a> Ejecutar la PoC</b></span><br>
									<img src="/blog/hacking/img/node.png">
								</div>
							</section>
							<!--- END EXPLOTANDO CVE-2024-21505 --->								
							
							<div style="border-top: 1px solid lightgray; width: 100%; margin: 10px 0;"></div>
						</div>
					</article>
				</main>
			</div>
		</div>
	</div>
						
	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="copyright">
						<a class="nodeco" href="/index"><img src="/blog/img/0xbogart-shadow.png" style="width: 15%"></a>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<a href="#" id="scrollToTopButtonRed"><i class="fas fa-arrow-up"></i></a>
<script>
function toggleNav() {
  var sidebar = document.getElementById("mySidebar");
  var sidebarDisplay = window.getComputedStyle(sidebar).display;

  if (sidebarDisplay === "none") {
    sidebar.style.display = "block"; // Mostrar el sidebar
    sidebar.style.width = "200px"; // Ancho deseado al mostrar el sidebar
  } else {
    sidebar.style.display = "none"; // Ocultar el sidebar al hacer clic nuevamente
  }
}
</script>
</body>
</html>
